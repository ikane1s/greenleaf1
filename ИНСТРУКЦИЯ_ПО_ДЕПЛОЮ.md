# Инструкция по размещению сервера на хостинге и покупке домена

## Оглавление
1. [Выбор хостинга](#выбор-хостинга)
2. [Покупка домена](#покупка-домена)
3. [Подготовка проекта к деплою](#подготовка-проекта-к-деплою)
4. [Деплой на VPS (Ubuntu/Debian)](#деплой-на-vps-ubuntudebian)
5. [Настройка домена и SSL](#настройка-домена-и-ssl)
6. [Настройка Telegram бота для production](#настройка-telegram-бота-для-production)
7. [Альтернативные варианты хостинга](#альтернативные-варианты-хостинга)

---

## Выбор хостинга

### Варианты хостинга:

#### 1. **VPS (Virtual Private Server)** - Рекомендуется для Node.js
- **DigitalOcean** (от $4/месяц) - https://www.digitalocean.com
- **Vultr** (от $2.50/месяц) - https://www.vultr.com
- **Hetzner** (от €4.15/месяц) - https://www.hetzner.com
- **Timeweb** (от 199₽/месяц) - https://timeweb.com
- **Selectel** (от 200₽/месяц) - https://selectel.ru

#### 2. **Облачные платформы**
- **Heroku** (есть бесплатный тариф) - https://www.heroku.com
- **Railway** (есть бесплатный тариф) - https://railway.app
- **Render** (есть бесплатный тариф) - https://render.com

---

## Покупка домена

### Популярные регистраторы:

1. **Namecheap** - https://www.namecheap.com
   - Простой интерфейс
   - Хорошие цены
   - Бесплатная защита WHOIS

2. **Reg.ru** - https://www.reg.ru (для .ru доменов)
   - Российский регистратор
   - Поддержка на русском
   - Хорошие цены на .ru/.рф домены

3. **GoDaddy** - https://www.godaddy.com
   - Мировые цены
   - Множество акций

4. **Timeweb Domains** - https://timeweb.com
   - Интеграция с хостингом
   - Удобное управление

### Процесс покупки домена:

1. Выберите регистратор
2. Проверьте доступность домена (например: greenleaf-shop.ru)
3. Добавьте домен в корзину
4. Оформите заказ (обычно на 1 год)
5. Завершите оплату
6. После покупки найдите раздел "DNS" или "Управление DNS"

---

## Подготовка проекта к деплою

### 1. Создайте файл `.env` на сервере:

```bash
# .env
NODE_ENV=production
BOT_TOKEN=your_telegram_bot_token
CHAT_ID=your_admin_chat_id
PORT=3001
```

### 2. Обновите API_URL в frontend:

В файле `src/pages/Partners.jsx` и `src/components/Callback/CallbackModal.jsx`:

```javascript
const API_URL = process.env.NODE_ENV === 'production' 
  ? 'https://yourdomain.com/api' 
  : 'http://localhost:3001/api';
```

Или создайте файл `.env` в корне frontend проекта:

```bash
REACT_APP_API_URL=https://yourdomain.com/api
```

И используйте:
```javascript
const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001/api';
```

---

## Деплой на VPS (Ubuntu/Debian)

### 1. Подключитесь к серверу:

```bash
ssh root@your_server_ip
```

### 2. Установите необходимые пакеты:

```bash
# Обновление системы
sudo apt update && sudo apt upgrade -y

# Установка Node.js (версия 20)
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

# Проверка версии
node -v
npm -v

# Установка PM2 для управления процессами
sudo npm install -g pm2

# Установка Nginx
sudo apt install -y nginx

# Установка certbot для SSL
sudo apt install -y certbot python3-certbot-nginx
```

### 3. Клонируйте проект на сервер:

```bash
cd /var/www
sudo git clone https://github.com/your-username/your-repo.git greenleaf
cd greenleaf
```

### 4. Настройте Backend:

```bash
cd backend
npm install

# Создайте .env файл
nano .env
# Вставьте ваши переменные окружения

# Запустите через PM2
pm2 start index.js --name greenleaf-backend
pm2 save
pm2 startup
```

### 5. Настройте Frontend:

```bash
cd ../src  # или где находится ваш frontend
npm install

# Создайте .env файл
echo "REACT_APP_API_URL=https://yourdomain.com/api" > .env

# Соберите проект
npm run build

# Скопируйте build в Nginx директорию
sudo cp -r build/* /var/www/html/
```

---

## Настройка домена и SSL

### 1. Настройте DNS записи у регистратора домена:

Добавьте A-запись:
- **Имя**: @ (или оставьте пустым)
- **Значение**: IP адрес вашего VPS сервера
- **TTL**: 3600 (или автоматически)

Если нужен поддомен для API:
- **Имя**: api
- **Значение**: IP адрес вашего VPS сервера

### 2. Настройте Nginx:

Создайте конфигурационный файл:

```bash
sudo nano /etc/nginx/sites-available/greenleaf
```

Вставьте следующую конфигурацию:

```nginx
# Редирект с HTTP на HTTPS
server {
    listen 80;
    server_name yourdomain.com www.yourdomain.com;
    
    location / {
        return 301 https://$server_name$request_uri;
    }
}

# Основной сервер (HTTPS)
server {
    listen 443 ssl http2;
    server_name yourdomain.com www.yourdomain.com;

    # SSL сертификаты (будут установлены certbot)
    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;

    # Настройки SSL
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers HIGH:!aNULL:!MD5;

    # Логи
    access_log /var/log/nginx/greenleaf_access.log;
    error_log /var/log/nginx/greenleaf_error.log;

    # Frontend (React приложение)
    location / {
        root /var/www/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

Активируйте конфигурацию:

```bash
sudo ln -s /etc/nginx/sites-available/greenleaf /etc/nginx/sites-enabled/
sudo nginx -t  # Проверка конфигурации
sudo systemctl restart nginx
```

### 3. Установите SSL сертификат:

```bash
sudo certbot --nginx -d yourdomain.com -d www.yourdomain.com
```

Следуйте инструкциям на экране. Certbot автоматически обновит конфигурацию Nginx.

### 4. Настройте автообновление SSL:

```bash
sudo certbot renew --dry-run
```

---

## Настройка Telegram бота для production

### 1. Убедитесь, что бот работает:

В файле `backend/index.js` проверьте:

```javascript
const BOT_TOKEN = process.env.BOT_TOKEN.trim();
const ADMIN_ID = Number(process.env.CHAT_ID);
```

### 2. Получите ваш Chat ID:

1. Найдите бота @userinfobot в Telegram
2. Отправьте ему /start
3. Скопируйте ваш ID
4. Добавьте в `.env`:

```bash
CHAT_ID=123456789  # Ваш реальный ID
```

### 3. Перезапустите backend:

```bash
pm2 restart greenleaf-backend
pm2 logs greenleaf-backend  # Для просмотра логов
```

---

## Альтернативные варианты хостинга

### Heroku (Простой вариант)

1. Создайте аккаунт на https://www.heroku.com
2. Установите Heroku CLI
3. В корне backend проекта:

```bash
heroku login
heroku create your-app-name
heroku config:set BOT_TOKEN=your_token
heroku config:set CHAT_ID=your_chat_id
git push heroku main
```

### Railway (Очень простой)

1. Зарегистрируйтесь на https://railway.app
2. Подключите GitHub репозиторий
3. Railway автоматически определит Node.js проект
4. Добавьте переменные окружения в настройках
5. Railway автоматически предоставит домен

### Render

1. Зарегистрируйтесь на https://render.com
2. Создайте новый Web Service
3. Подключите GitHub репозиторий
4. Укажите:
   - Build Command: `cd backend && npm install`
   - Start Command: `cd backend && node index.js`
5. Добавьте переменные окружения
6. Render предоставит бесплатный домен

---

## Полезные команды

### PM2 команды:

```bash
pm2 list                    # Список процессов
pm2 restart greenleaf-backend  # Перезапуск
pm2 stop greenleaf-backend     # Остановка
pm2 logs greenleaf-backend     # Логи
pm2 monit                     # Мониторинг
```

### Nginx команды:

```bash
sudo nginx -t              # Проверка конфигурации
sudo systemctl restart nginx  # Перезапуск
sudo systemctl status nginx   # Статус
```

### Проверка работы:

```bash
# Проверка backend
curl http://localhost:3001/api/health

# Проверка портов
sudo netstat -tulpn | grep LISTEN
```

---

## Частые проблемы и решения

### 1. Бот не отвечает
- Проверьте правильность BOT_TOKEN
- Убедитесь, что CHAT_ID указан правильно
- Проверьте логи: `pm2 logs greenleaf-backend`

### 2. API не доступен
- Проверьте, что backend запущен: `pm2 list`
- Проверьте firewall: `sudo ufw status`
- Проверьте логи Nginx: `sudo tail -f /var/log/nginx/error.log`

### 3. SSL сертификат не устанавливается
- Убедитесь, что DNS записи настроены правильно (может занять до 24 часов)
- Проверьте, что порт 80 открыт: `sudo ufw allow 80`

### 4. Домен не работает
- Проверьте DNS записи: `nslookup yourdomain.com`
- Убедитесь, что Nginx запущен: `sudo systemctl status nginx`

---

## Безопасность

### Обязательно:

1. **Настройте Firewall:**
```bash
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable
```

2. **Регулярно обновляйте систему:**
```bash
sudo apt update && sudo apt upgrade -y
```

3. **Не храните секреты в Git:**
- Используйте `.env` файлы
- Добавьте `.env` в `.gitignore`

4. **Настройте автоматическое резервное копирование:**
```bash
# Пример скрипта для backup
sudo crontab -e
# Добавьте: 0 2 * * * /path/to/backup-script.sh
```

---

## Резюме

1. ✅ Выберите VPS или облачный хостинг
2. ✅ Купите домен у регистратора
3. ✅ Настройте DNS записи
4. ✅ Установите Node.js, PM2, Nginx на сервере
5. ✅ Задеплойте backend и frontend
6. ✅ Настройте Nginx как reverse proxy
7. ✅ Установите SSL сертификат через certbot
8. ✅ Настройте переменные окружения для бота
9. ✅ Проверьте работу всех компонентов

После выполнения всех шагов ваш сайт будет доступен по адресу https://yourdomain.com!


